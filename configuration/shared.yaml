# Remove pre-installed apps using a custom script
- resource: PSDscResources/Script
  id: WindowsDebloatScript
  directives:
    description: Remove pre-installed apps
  settings:
    GetScript: |
      $appsList = @("Microsoft.MicrosoftSolitaireCollection", "Clipchamp.Clipchamp", "MicrosoftTeams", "Microsoft.BingNews", "Microsoft.People", "Microsoft.PowerAutomateDesktop", "SpotifyAB.SpotifyMusic")

      $foundApps = @()
      foreach ($app in $appsList) {
          $foundApp = Get-AppxPackage -AllUsers -Name $app

          if ($foundApp -ne $null) {
              $foundApps += $foundApp
          }
      }

      return @{
          Result = $foundApps
      }
    TestScript: |
      $appsList = @("Microsoft.MicrosoftSolitaireCollection", "Clipchamp.Clipchamp", "MicrosoftTeams", "Microsoft.BingNews", "Microsoft.People", "Microsoft.PowerAutomateDesktop", "SpotifyAB.SpotifyMusic")

      foreach ($app in $appsList) {
          $foundApp = Get-AppxPackage -Name $app

          if ($foundApp -ne $null) {
              return $false
          }
      }

      return $true
    SetScript: |
      $appsList = @("Microsoft.MicrosoftSolitaireCollection", "Clipchamp.Clipchamp", "MicrosoftTeams", "Microsoft.BingNews", "Microsoft.People", "Microsoft.PowerAutomateDesktop", "SpotifyAB.SpotifyMusic")

      foreach ($app in $appsList) {
          # Remove installed app for all existing users
          Get-AppxPackage -Name $app -AllUsers | Remove-AppxPackage
      }

      function unpin_taskbar([string]$appname) {
          ((New-Object -Com Shell.Application).NameSpace('shell:::{4234d49b-0245-4df3-b780-3893943456e1}').Items() `
          | Where-Object{$_.Name -eq $appname}).Verbs() | Where-Object{$_.Name.replace('&','') -match 'Unpin from taskbar'} `
          | ForEach-Object{$_.DoIt()}
      }

      unpin_taskbar('Microsoft Store')
      unpin_taskbar('Microsoft Edge')

# Enable Developer Mode
- resource: Microsoft.Windows.Developer/DeveloperMode
  id: DeveloperMode
  directives:
    description: Enable Developer Mode
    allowPrerelease: true
  settings:
    Ensure: Present

# Install Telegram
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: Telegram
  directives:
    description: Install Telegram
    allowPrerelease: true
  settings:
    id: Telegram.TelegramDesktop
    source: winget
    Ensure: Present

# Install Discord
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: Discord
  directives:
    description: Install Discord
    allowPrerelease: true
  settings:
    id: Discord.Discord
    source: winget
    Ensure: Present

# Install Signal
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: Signal
  directives:
    description: Install Signal
    allowPrerelease: true
  settings:
    id: OpenWhisperSystems.Signal
    source: winget
    Ensure: Present

# Install Bitwarden.Bitwarden
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: Bitwarden
  directives:
    description: Install Bitwarden
    allowPrerelease: true
  settings:
    id: Bitwarden.Bitwarden
    source: winget
    Ensure: Present

# Install Microsoft.PowerToys
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: PowerToys
  directives:
    description: Install Microsoft PowerToys
    allowPrerelease: true
  settings:
    id: Microsoft.PowerToys
    source: winget
    Ensure: Present

- resource: PowerToysConfigure
  directives:
    description: Configure PowerToys
  settings:
    ShortcutGuide:
      Enabled: false
      OverlayOpacity: 1
    FancyZones:
      Enabled: true
      FancyzonesEditorHotkey: "Shift+Ctrl+Alt+F"

# Intall 7zip
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: 7zip
  directives:
    description: Install 7zip
    allowPrerelease: true
  settings:
    id: 7zip.7zip
    source: winget
    Ensure: Present

# Install Microsoft Powershell
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: MicrosoftPowershell
  directives:
    description: Install Microsoft Powershell
    allowPrerelease: true
  settings:
    id: Microsoft.PowerShell
    source: winget
    Ensure: Present

# Install OhMyPosh
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: OhMyPosh
  directives:
    description: Install OhMyPosh
    allowPrerelease: true
  settings:
    id: JanDeDobbeleer.OhMyPosh
    source: winget
    Ensure: Present

# Install Sysinternals
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: Sysinternals
  directives:
    description: Install Sysinternals
    allowPrerelease: true
  settings:
    id: Microsoft.Sysinternals
    source: winget
    Ensure: Present

# Install GnuPG.Gpg4win
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: Gpg4win
  directives:
    description: Install Gpg4win
    allowPrerelease: true
  settings:
    id: GnuPG.Gpg4win
    source: winget
    Ensure: Present

# Install Yubico.YubikeyManager
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: YubikeyManager
  directives:
    description: Install Yubikey Manager
    allowPrerelease: true
  settings:
    id: Yubico.YubikeyManager
    source: winget
    Ensure: Present

# Install Postman
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: Postman
  directives:
    description: Install Postman
    allowPrerelease: true
  settings:
    id: Postman.Postman
    source: winget
    Ensure: Present

# Install Obsidian
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: Obsidian
  directives:
    description: Install Obsidian
    allowPrerelease: true
  settings:
    id: Obsidian.Obsidian
    source: winget
    Ensure: Present

# Install Visual Studio Code
- resource: Microsoft.WinGet.DSC/WinGetPackage
  id: VisualStudioCode
  directives:
    description: Install Visual Studio Code
    allowPrerelease: true
  settings:
    id: Microsoft.VisualStudioCode
    source: winget
    Ensure: Present

# Update the start menu layout to show fewer recommendations and more pins
- resource: PSDscResources/Registry
  id: UpdateStartLayout
  directives:
    description: Updates the start menu layout to less recommendations and more pins
    allowPrerelease: false
  settings:
    Key: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
    ValueName: Start_Layout
    ValueType: DWord
    ValueData: 1
    Force: true
    Ensure: Present

# Remove the widgets button from the taskbar
- resource: PSDscResources/Registry
  id: RemoveTaskBarWidgetsButton
  directives:
    description: Removes the widgets button from the taskbar
    allowPrerelease: true
  settings:
    Key: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
    ValueName: TaskbarDa
    ValueType: DWord
    ValueData: 0
    Force: true
    Ensure: Present

# Remove the chat button from the taskbar
- resource: PSDscResources/Registry
  id: RemoveTaskBarChatButton
  directives:
    description: Removes the chat button from the taskbar
    allowPrerelease: true
  settings:
    Key: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced
    ValueName: TaskbarMn
    ValueType: DWord
    ValueData: 0
    Force: true
    Ensure: Present

# Remove the search field from the taskbar
- resource: PSDscResources/Registry
  id: RemoveTaskBarSearchField
  directives:
    description: Removes the search field from the taskbar
    allowPrerelease: true
  settings:
    Key: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Search
    ValueName: SearchboxTaskbarMode
    ValueType: DWord
    ValueData: 0
    Force: true
    Ensure: Present

# Set windows explorer settings
- resource: Microsoft.Windows.Developer/WindowsExplorer
  directives:
    description: Modify Windows Explorer settings
    allowPrerelease: true
  settings:
    FileExtensions: Show
    HiddenFiles: Show
    ItemCheckBoxes: Hide
    RestartExplorer: True # Use caution when setting `RestartExplorer: true` as this will force explorer to close. Required for all WindowsExplorer settings.

# Enable dark mode
- resource: Microsoft.Windows.Developer/EnableDarkMode
  directives:
    description: Disable dark mode
    allowPrerelease: true
  settings:
    Ensure: Absent
    # Use caution when setting `RestartExplorer: true` as this will force explorer to close.
    RestartExplorer: true # Required to apply changes

# Enable Windows Sandbox
- resource: PSDscResources/WindowsOptionalFeature
  id: WindowsSandbox
  directives:
    description: Ensure Windows Sandbox is enabled
  settings:
    Name: Containers-DisposableClientVM
    Ensure: Present
